
pt-xact-stat
============

概要
----

複数ノードのトランザクションの統計状況を表示します。指定したインターバルごとに連続的に表示することも可能です。

実行方法
--------

.. code-block:: none

   pt-xact-stat [option...] [delay [count]]

オプション
----------

.. code-block:: none

  -h, --host=HOSTNAME
  -p, --port=PORT
  -H, --host-list=HOSTLIST
  -U, --username=USERNAME
  -d, --dbname=DBNAME
  -H, --host-list=HOSTNAME:PORT,HOSTNAME:PORT[,...]

``-h``, ``--host`` オプションは、接続するPostgreSQLデータベースのサーバ名またはIPアドレスを指定します。オプションが指定されない場合は、PGHOST環境変数に設定された値が使われます。PGHOST環境変数が設定されていない場合には、デフォルトの値として ``localhost`` が使われます。

``-p``, ``--port`` オプションは、接続するPostgreSQLデータベースのポート番号を指定します。オプションが指定されない場合は、PGPORT環境変数に設定された値が使われます。PGPORT環境変数が設定されていない場合には、デフォルトの値として ``5432`` が使われます。

``-H``, ``--host-list`` オプションは、接続するPostgreSQLサーバが複数ある場合にデータベースのサーバ名またはIPアドレスとポート番号の組み合わせを複数指定します。書式は ``192.168.1.101:5432,192.168.1.102:5433`` のように、一組のサーバ名とポート番号をコロン ``:`` で連結し、複数のサーバをカンマ ``,`` で連結します。ポート番号は省略可能で、省略した場合はデフォルトのポート番号が使われます。

``-U``, ``--username`` オプションは、PostgreSQLデータベースに接続するユーザ名を指定します。オプションが指定されない場合は、PGUSER環境変数に設定された値が使われます。PGUSER環境変数が設定されていない場合には、USER環境変数に設定された値が使われます。

``-d``, ``--dbname`` オプションは、接続するデータベース名を指定します。オプションが指定されない場合は、PGDATABASE環境変数に設定された値が使われます。PGDATABASE環境変数が設定されていない場合には、データベースに接続するユーザ名と同じ名前のデータベースに接続します。


出力項目
--------

.. csv-table::

   ``HOST``, PostgreSQLサーバのホスト名
   ``PORT``, PostgreSQLサーバのポート番号
   ``DBNAME``, データベース名
   ``CONN``, データベースに接続しているセッション数
   ``COMMITS``, コミットされたトランザクション総数
   ``ROLLBACKS``, ロールバックされたトランザクション総数
   ``B_READ``, ディスクから読み込まれたテーブルのブロック数
   ``B_HIT``, 共有バッファから読み込まれたテーブルのページ数


実行例
------

ローカルホストのポート5432とポート5433で動作している2つのPostgreSQLインスタンスに接続して、各インスタンスのトランザクションの統計情報を5秒おきに2回表示します。

.. code-block:: none

   $ pt-xact-stat --host-list 127.0.0.1:5432,127.0.0.1:5433,127.0.0.1:5434 -d postgres 5 2
   Sat Mar 28 20:47:50 JST 2015
   +-----------+------+----------+------+---------+-----------+--------+-------+
   |    HOST   | PORT |  DBNAME  | CONN | COMMITS | ROLLBACKS | B_READ | B_HIT |
   +-----------+------+----------+------+---------+-----------+--------+-------+
   | 127.0.0.1 | 5432 | postgres |    1 |     137 |         1 |    104 | 10273 |
   | 127.0.0.1 | 5433 | postgres |    1 |       8 |         0 |    104 |  1350 |
   | 127.0.0.1 | 5434 | postgres |    1 |      76 |         0 |    104 |  7708 |
   +-----------+------+----------+------+---------+-----------+--------+-------+
   
   Sat Mar 28 20:47:55 JST 2015
   +-----------+------+----------+------+---------+-----------+--------+-------+
   |    HOST   | PORT |  DBNAME  | CONN | COMMITS | ROLLBACKS | B_READ | B_HIT |
   +-----------+------+----------+------+---------+-----------+--------+-------+
   | 127.0.0.1 | 5432 | postgres |    1 |     139 |         1 |    104 | 10460 |
   | 127.0.0.1 | 5433 | postgres |    1 |      10 |         0 |    104 |  1537 |
   | 127.0.0.1 | 5434 | postgres |    1 |      78 |         0 |    104 |  7895 |
   +-----------+------+----------+------+---------+-----------+--------+-------+
   
   $

ローカルホストのポート5432, ポート5433, ポート5434で動作している3つのPostgreSQLインスタンスに接続して、各インスタンスのトランザクションの統計情報を1回表示して終了します。

.. code-block:: none

   $ pt-xact-stat --host-list 127.0.0.1:5432,127.0.0.1:5433,127.0.0.1:5434 -d postgres
   Sat Mar 28 21:05:48 JST 2015
   +-----------+------+----------+------+---------+-----------+--------+-------+
   |    HOST   | PORT |  DBNAME  | CONN | COMMITS | ROLLBACKS | B_READ | B_HIT |
   +-----------+------+----------+------+---------+-----------+--------+-------+
   | 127.0.0.1 | 5432 | postgres |    1 |      12 |         0 |    104 |  1400 |
   | 127.0.0.1 | 5433 | postgres |    1 |       4 |         0 |    104 |   976 |
   | 127.0.0.1 | 5434 | postgres |    1 |       4 |         0 |    104 |   976 |
   +-----------+------+----------+------+---------+-----------+--------+-------+
   
   $
