
pt-table-usage
==============

概要
----

テーブルの使用状況を表示します。


実行方法
--------

.. code-block:: none

   pt-table-usage [option...]

オプション
----------

.. code-block:: none

  -h, --host=HOSTNAME
  -p, --port=PORT
  -U, --username=USERNAME
  -d, --dbname=DBNAME
  -o, --owner=STRING
  -n, --schema=STRING
  -t, --table=STRING
  --help

``-h``, ``--host`` オプションは、接続するPostgreSQLデータベースのサーバ名またはIPアドレスを指定します。オプションが指定されない場合は、PGHOST環境変数に設定された値が使われます。PGHOST環境変数が設定されていない場合には、デフォルトの値として ``localhost`` が使われます。

``-p``, ``--port`` オプションは、接続するPostgreSQLデータベースのポート番号を指定します。オプションが指定されない場合は、PGPORT環境変数に設定された値が使われます。PGPORT環境変数が設定されていない場合には、デフォルトの値として ``5432`` が使われます。

``-U``, ``--username`` オプションは、PostgreSQLデータベースに接続するユーザ名を指定します。オプションが指定されない場合は、PGUSER環境変数に設定された値が使われます。PGUSER環境変数が設定されていない場合には、USER環境変数に設定された値が使われます。

``-d``, ``--dbname`` オプションは、接続するデータベース名を指定します。オプションが指定されない場合は、PGDATABASE環境変数に設定された値が使われます。PGDATABASE環境変数が設定されていない場合には、データベースに接続するユーザ名と同じ名前のデータベースに接続します。

``-o``, ``--owner`` オプションは、指定した文字列に合致する名前のユーザが所有者となっているテーブルの情報のみを表示します。スラッシュで挟むことで正規表現を指定することもできます（例: ``/REGEXP/`` ）。

``-n``, ``--schema`` オプションは、指定した文字列に合致する名前のスキーマにあるテーブルの情報のみを表示します。スラッシュで挟むことで正規表現を指定することもできます（例: ``/REGEXP/`` ）。

``-t``, ``--table`` オプションは、指定した文字列に合致する名前のテーブルの情報のみを表示します。スラッシュで挟むことで正規表現を指定することもできます（例: ``/REGEXP/`` ）。

``-d`` （または ``--dbname`` ）, ``-o`` （または ``--owner`` ）,  ``-n`` （または ``--schema`` ）, ``-t`` （または ``--table`` ） を同時に指定した場合には、すべての条件に合致するテーブルのみが表示対象となります。


出力項目
--------

.. csv-table::

   ``OID``, テーブルのオブジェクトID
   ``OWNER``, テーブルの所有者のユーザ名
   ``SCHEMA``, テーブルの存在しているスキーマ名
   ``TABLE``, テーブル名
   ``BLKS``, テーブルのブロック数（8kB単位）
   ``SCAN``, シーケンシャルスキャンの実行回数
   ``T_READ``, シーケンシャルスキャンによって取得されたタプル数
   ``T_INS``, 挿入されたタプル数
   ``T_UPD``, 更新されたタプル数（HOT UPDATEを含む）
   ``T_DEL``, 削除されたタプル数
   ``B_READ``, ディスクから読み込まれたテーブルのブロック数
   ``B_HIT``, 共有バッファから読み込まれたテーブルのページ数
   ``VACUUMED``, 最後にVACUUMされた日時（VACUUMコマンドおよび自動VACUUMのいずれか）
   ``ANALYZED``, 最後にANALYZEされた日時（ANALYZEコマンドおよび自動ANALYZEのいずれか）
   ``TABLESPACE``, テーブルの配置されているテーブルスペース名。

実行例
------

``localhost`` のポート ``5432`` で動作しているPostgreSQLインスタンスに接続し、``dbt3`` データベースの全テーブルの利用状況を表示します。

.. code-block:: none

   $ pt-table-usage -d dbt3
   +---------+-------+--------+----------+--------+------+----------+---------+-------+-------+--------+---------+----------+---------------------+------------+
   |   OID   | OWNER | SCHEMA |  TABLE   |  BLKS  | SCAN |  T_READ  |  T_INS  | T_UPD | T_DEL | B_READ |  B_HIT  | VACUUMED |       ANALYZED      | TABLESPACE |
   +---------+-------+--------+----------+--------+------+----------+---------+-------+-------+--------+---------+----------+---------------------+------------+
   | 1273410 | snaga | public | customer |   3531 |    5 |   750000 |  150000 |     0 |     0 |   6499 |   29943 |          | 2015-03-08 18:31:41 | ssdspc1    |
   | 1273416 | snaga | public | lineitem | 106583 |   12 | 66656465 | 6001215 |     0 |     0 | 240547 | 1340871 |          | 2015-03-08 18:31:42 | ssdspc1    |
   | 1273419 | snaga | public | nation   |      1 |    4 |      100 |      25 |     0 |     0 |      1 |       5 |          | 2015-03-08 18:31:42 | ssdspc1    |
   | 1273413 | snaga | public | orders   |  25326 |    5 |  7500000 | 1500000 |     0 |     0 |  48612 |  208386 |          | 2015-03-08 18:31:41 | ssdspc1    |
   | 1273404 | snaga | public | part     |   4064 |    3 |   600000 |  200000 |     0 |     0 |   6082 |   26558 |          | 2015-03-08 18:31:40 | ssdspc1    |
   | 1273407 | snaga | public | partsupp |  17087 |    5 |  4000000 |  800000 |     0 |     0 |  32200 |  148518 |          | 2015-03-08 18:31:41 | ssdspc1    |
   | 1273422 | snaga | public | region   |      1 |    3 |       15 |       5 |     0 |     0 |      1 |       4 |          | 2015-03-08 18:31:42 | ssdspc1    |
   | 1273401 | snaga | public | supplier |    218 |    4 |    40000 |   10000 |     0 |     0 |    220 |    1802 |          | 2015-03-08 18:31:40 | ssdspc1    |
   +---------+-------+--------+----------+--------+------+----------+---------+-------+-------+--------+---------+----------+---------------------+------------+
   $ 

``localhost`` のポート ``5432`` で動作しているPostgreSQLインスタンスに接続し、``dbt3`` データベースにあるテーブルのうち、 ``pa`` で始まる名前のテーブルの利用状況を表示します。

.. code-block:: none

   $ pt-table-usage -d dbt3 -t /^pa/
   +---------+-------+--------+----------+-------+------+---------+--------+-------+-------+--------+--------+----------+---------------------+------------+
   |   OID   | OWNER | SCHEMA |  TABLE   |  BLKS | SCAN |  T_READ | T_INS  | T_UPD | T_DEL | B_READ | B_HIT  | VACUUMED |       ANALYZED      | TABLESPACE |
   +---------+-------+--------+----------+-------+------+---------+--------+-------+-------+--------+--------+----------+---------------------+------------+
   | 1273404 | snaga | public | part     |  4064 |    3 |  600000 | 200000 |     0 |     0 |   6082 |  26558 |          | 2015-03-08 18:31:40 | ssdspc1    |
   | 1273407 | snaga | public | partsupp | 17087 |    5 | 4000000 | 800000 |     0 |     0 |  32200 | 148518 |          | 2015-03-08 18:31:41 | ssdspc1    |
   +---------+-------+--------+----------+-------+------+---------+--------+-------+-------+--------+--------+----------+---------------------+------------+
   $
